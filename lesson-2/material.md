# Lesson 2. Node js основы

- Архитектура REST. RESTful API
- Semver
- Объект global, глобальные переменные
- Синхронность, асинхронность процессов
    - event loop
- Работа с каталогами
- Работа с файлами
- Stream, Pipe
- Websockets/AJAX
    - Socket.io 

## Архитектура REST. RESTful API

REST — REpresentational State Transfer. Это передача/изменения состояния через представления. REST — это архитектурный стиль, некоторое множество ограничений, для построения распределенных приложений.

Архитектура REST описывается следующими ограничениями. 

- [Единый интерфейс (Uniform Interface)](http://www.restapitutorial.ru/lessons/whatisrest.html#uniform-interface)
- [Отсутствие состояний (Stateless)](http://www.restapitutorial.ru/lessons/whatisrest.html#stateless)
- [Кеширование ответа (Cacheable)](http://www.restapitutorial.ru/lessons/whatisrest.html#cacheable)
- [Клиент-сервер (Client-Server)](http://www.restapitutorial.ru/lessons/whatisrest.html#client-server)
- [Многоуровневая система (Layered System)](http://www.restapitutorial.ru/lessons/whatisrest.html#layered-system)

Чем больше ограничений вы выполните, тем более "full" получится приложение. В теории при выполнении всех требований вы получайте **RESTful** приложение, если соблюдать только часть из них это **REST-like**.

Ключевое понятие в REST — это ресурс. Ресурс имеет состояние, и мы можем его получать или изменять при помощи представлений. Наше приложение отвечает за некоторое множество таких ресурсов. Кстати, совокупное состояние ресурсов — это и есть состояние приложения.

Примеры ресурсов:

- Пользователи системы
- Курсы, в которых зарегистрирован студент
- История сообщений пользователя
- Пользователь
- Товар магазина
- Товары магазина
- Категория товаров магазина
- Категории товаров магазина

Чтобы создать нового покупателя в системе мы используем:

`POST http://www.example.com/customers`

Чтобы создать новый товар мы используем:

`POST http://www.example.com/product`

Для чтения, обновления, удаления продукта с id `66432`.

`GET|PUT|DELETE http://www.example.com/products/66432`

Чтобы получить информацию о товаре с id `12345` мы используем :

`GET http://www.example.com/product/12345`  

Тот же URI мы используем для PUT и DELETE, чтобы обновлять и удалять, соответственно.

Ниже предложен URI для получения всех продуктов:

`GET http://www.example.com/products`

Продуктов определенной категории:

`GET http://www.example.com/auto/products`


Каждый ресурс сервиса должен иметь хотя бы один URI, идентифицирующий его. И лучше всего, когда этот URI имеет смысл и адекватно описывает этот ресурс. URI должны иметь предсказуемую структуру.

Под представлением можно понимать JSON/HTML/XML/текст в определенном формате или что угодно, что позволяет нам понимать состояние ресурса или его модифицировать.

### Статьи
- [Именование ресурсов](http://www.restapitutorial.ru/lessons/restfulresourcenaming.html)
- [Понимание REST](https://dou.ua/lenta/articles/rest-conception/)


## SEMVER

Когда мы устанавливаем какой-то пакет, например, express, то в package.json добавляется последняя версия пакета, состоящая из трех цифр. Эти цифры означают Major, Minor, Patch и используют как спецификацию semver.

Что это значит? Когда я делаю пакет и еще не опубликовал его, то первая цифра идет 0. Это значит, что какие бы номера версий не шли дальше, я могу в любом момент менять любой функционал пакета. Потому что пакет, начинающийся с 0 - нестабильный пакет.

Когда мы опубликовали пакет, то каждый номер версии начинает иметь смысл. Последняя цифра - это PATCH. То есть внесение незначительных изменений в пакет, например bugfix.

Средняя цифра - это минорная версия. Она должна обновляться при изменениях, которые добавляют новый функционал, но не ломают то, что уже работает. Таким образом любой человек может обновится с 1.2.0 на 1.3.0 и все должно по прежнему работать.

Первая же цифра - это мажорная версия. Если внеслись хоть какие-то изменения, которые сломали текущий код, то должна релизится новая мажорная версия. Это может быть как изменение API, так и изменение порядка аргументов. Поэтому нужно делать версию 2.0.0.

Собственно вся система версий и пакетов подчиняется спецификации semver.

Мы можем указать, что пакет должен быть больше версии 1.2.7

`>= 1.2.7`

Тогда, при установке пакетов версия будет искаться только среди версий, которые больше 1.2.7.

Также можно указывать range.

`>=1.2.7 <1.3.0`

Также есть специальные пре релизные теги.

`1.2.3-alpha.3`
`1.2.3-beta.0`

Также часто встречаются тильда и каретка.

Когда у нас стоит тильда

`~1.2.3`
Это значит, что версия может меняться только от 1.2.3 до 1.3.0, то есть могут применятся только патчи, а минорная версия обновлятся не может.

Если же у нас стоит каретка

`^1.2.3`
То можно обновлять и минорную версию и накатывать патчи. То есть от 1.2.3 до 2.0.0.

[Видео с обьяснением](https://monsterlessons.com/project/lessons/razbiraemsya-s-versiyami-paketov-v-node)

## Объект global, глобальные переменные

Node.js предоставляет специальный объект `global`, который предоставляет доступ к глобальным, то есть доступным из каждого модуля приложения, переменным и функциям. 

Примерным аналогом данного объекта в javascript для браузера является объект `window`. Все доступные глобальные объекты можно посмотреть в [документации](https://nodejs.org/api/globals.html).

Примеры глобальных переменных:

- `__filename` указывает имя файла который в настоящее время выполняется. Абсолютный путь к месту где находится файл. 
- `__dirname` указывает адрес каталога где лежит файл что сейчас выполняется. Абсолютный путь к месту где находится каталог.
- `setInterval, setTimeout`
- `process`

[Документация на русском](http://www.w3big.com/ru/nodejs/nodejs-global-object.html)

Рекомендуется избегать определения и использования глобальных переменных, и преимущественно ориентироваться на создание переменных, инкапсулированных в рамках отдельных модулей.

[Статья с примером](https://metanit.com/web/nodejs/2.3.php)

## Синхронность, асинхронность процессов

### Event loop
[Статья об ивент луп](https://medium.com/front-end-hacking/javascript-event-loop-explained-4cd26af121d4)
[Видео об ивент луп](https://medium.com/front-end-hacking/javascript-event-loop-explained-4cd26af121d4)

