# Lesson 7

- Подстройка чата для пользователей приложения
- Авторизация с помощью Json Web Token (JWT)

## Подстройка чата для пользователей приложения



## Авторизация с помощью Json Web Token (JWT)

Аутентификация - проверка подлинности пользователя путём сравнения введённого им логина/пароля с данными сохранёнными в базе данных.

Авторизация - проверка прав пользователя на доступ к определенным ресурсам.


Все пользователи вашего сайта или приложения имеют абсолютно разные права доступа к нему. Например: модераторы сайта которые вносят новости и простые пользователи.
Либо же пользователи что имеют платный аккаунт и те, что имеют бесплатный.

В обоих случаях нужно каким-то образом разграничивать права этих пользователей.

Для того, чтобы пользователь мог авторизоваться в системе, у него, естественно, должна быть учётная запись в этой самой системе. Следовательно, ему нужно предоставить возможность эту учётную запись каким-то образом создать. 
Но здесь есть пара нюансов. 
Как правило, учётные данные пользователя состоят из традиционных логина и пароля (ну и необозримого количества всяких необязательных полей на вкус разработчика).

Пароли стоит хранить в шифрованном виде, для того чтобы их не смогли использовать злоумышленники. Еще более безопасный способ хранения - хеш. Это набор символов в который закодировано ваше сообщение. Раскодировать его можно лишь с помощью специального ключа. 

Даже получив в своё распоряжение хеши, злоумышленник не сможет восстановить пароли, а, следовательно, авторизоваться в системе, используя учётную запись, данные которой получил в своё распоряжение.

#### Как происходит создание  Json Web Token

- Получаем пароль от пользователя
- Генерируем хеш
- Записываем хеш
- При авторизации пользователь присылает нам логин и пароль, мы ищем его учётную запись по логину, хешируем присланный пароль, сверяем полученный хеш с тем, что записан в учётной записи
- Высылаем пользователю кодированный веб-токен
- При дальнейших действиях пользователя в системе проверяем веб-токен

Можно еще например добавить время устаревания веб-токена, проверку IP. Но базовая схема именно такова.


[О Json Web Token](http://whiteshieldsoftware.blogspot.com/2016/06/expressjs-user-login-and-registration.html)


## Домашнее задание

1. Поменять в приложении роут `users/create` на `sign-up`
2. Создать `POST` роут `login` по которому у пользователя должна быть возможность получить JSON web token в хедере и ответ от сервера (пример в папке `JSON-web-token`)

    ```
    {
      "status": "success", 
      "user": <user>
    }
    ```
3. Сделать `GET` роут `products/search`в приложении который будет присылать любые данные из товара (Одно поле `?param=value` или несколько `?param=value&param2=value2`). Например имя. 
В ответ должен приходить массив из товарами, которые были найдены в базе данных. Поиск должен быть по любым полям товара (кроме id)

    ```
     {
       "status": "success", 
       "products": [
            <product-1>,
            <product-2>
       ]
      }
      ```

    Если товар был не найден то в ответ просто приходит `{ 'status': 'not found'}`

4. Создать следующие модели в mongoDB
    - Message
    ```
    {
        message: String,
        conversationId: <conversationId>,
        author: <userId> 
    }
    ```
    
    - Conversation
    ```
    {
        name: String,
        participants: [
            <userId>,
            <userId>
        ] 
    }
    ```
5. Расширить модель User полем `conversations: [ <conversationId> ]`. Сделать (или проверить) возможность его изменения через запрос .
6. Сделать простой фронтенд для бекенда (можно без стилей)
    - оправлял запрос на получения юзера 
    - рисовал юзера на фронтенде (можно просто выводить текст всех полей что есть в user модели)
    - оправлял запрос на получения товара
    - рисовал товар на фронтенде (можно просто выводить текст всех полей что есть в product модели)
    - оправлял запрос на получения диалога (conversation)
    - рисовал id участников диалога на фронтенде